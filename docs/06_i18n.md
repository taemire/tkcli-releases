# 6. 다국어 지원 (i18n)

TKCLI는 시스템의 언어 설정을 자동으로 감지하여 다국어를 지원합니다.

## 6.1 자동 언어 감지

시스템의 `LANG` 또는 `LC_ALL` 환경 변수를 감지합니다.

```bash
# 영문 환경
LANG=en_US.UTF-8 tkcli info
# → 영어 출력

# 한글 환경
LANG=ko_KR.UTF-8 tkcli info
# → 한국어 출력
```

## 6.2 수동 언어 설정 및 강제 전환

SSH 클라이언트 설정이나 터미널 폰트 문제로 한글이 깨져 보일 경우, 다음 방법 중 하나를 선택하여 강제로 영문 언어로 전환할 수 있습니다.

### 방법 1: 실행 시 플래그 사용 (일회성 및 환경 자동 반영)

모든 명령어에 `-l` (소문자 L) 또는 `--lang` 플래그를 사용하여 언어를 지정할 수 있습니다. 한번 이 플래그를 사용하여 실행하면, 해당 설정이 자동으로 `tkcli.ini`에 저장되어 이후 실행부터는 플래그 없이도 유지됩니다. 또한 `auto` 값을 입력하면 저장된 설정을 삭제하고 다시 시스템 자동 감지 모드로 복원할 수 있습니다.

```bash
# 강제로 영문으로 전환하고 설정 저장
tkcli --lang en version

# 다시 자동 감지 모드로 복원 (설정 삭제)
tkcli --lang auto version

# 강제로 한글로 전환하고 설정 저장
tkcli -l ko version
```

### 방법 2: 설정 파일에서 영구 수정 (`tkcli.ini`)

`tkcli`가 설치된 경로의 `tkcli.ini` 파일을 직접 수정하여 언어를 고정할 수 있습니다.

```ini
basedir=/usr/local/TACHYON/TTS40
log_level=DEBUG
language=en
```

## 6.3 지능형 인코딩 감지 (자동 전환)

`tkcli`는 터미널 환경이 한글 출력을 정상적으로 지원하지 못할 것으로 판단되면 본인(시스템)의 로케일이 한글(`ko`)이더라도 자동으로 영문(`en`)으로 전환하여 출력 깨짐을 방지합니다.

- **감지 로직**: `LANG` 환경 변수가 `ko` 계열이지만 `UTF-8` 문자열을 포함하지 않는 경우 (예: `ko_KR.EUC-KR` 또는 `ko_KR`), 안전을 위해 자동으로 영문 언어팩을 활성화합니다.
- **복구 방법**: 만약 터미널이 한글 지원이 가능함에도 영문으로 나온다면, `tkcli --lang ko` 명령을 실행하여 수동으로 설정을 강제화하십시오.

## 6.4 내장 언어팩

- **영어 (en)**: 기본 언어
- **한국어 (ko)**: 완전 번역

## 6.5 다국어 데이터 정합성 유지 (v0.3.30+)

TKCLI는 각 언어별 JSON 파일 간의 키 일치성을 자동화된 테스트를 통해 보장합니다.

### 데이터 검증 테스트
개발 단계에서 `go test ./internal/i18n/...` 명령을 통해 다음 사항을 검증합니다:
- **키 일치성 (`TestI18nKeysConsistency`)**: `ko.json`과 `en.json`에 정의된 모든 메시지 키가 1:1로 정확히 일치하는지 확인합니다.
- **도움말 필수 키 (`TestHelpKeysExist`)**: 모든 필수 명령어의 `Long` 설명과 `Example` 예시 키가 누락 없이 존재하는지 확인합니다.

### 명령어 도움말 키 명칭 규칙
동적 언어 전환 및 서브커맨드 지원을 위해 다음과 같은 명칭 패턴을 권장하며, 시스템은 이를 자동으로 인지하여 적용합니다:
- **명령어 설명**: `[command]_short`, `[command]_long`
- **예제**: `[command]_example`
- **서브커맨드**: `[parent]_[child]_short`, `[parent]_[child]_long`
- **플래그**: `[command]_[flag_name]_flag`

---

## 6.6 사용자 정의 언어팩

TKCLI 실행 경로에 `lang` 디렉토리를 만들고 JSON 파일을 추가하면 새로운 언어를 지원할 수 있습니다.

### 언어팩 생성 절차

1. **디렉토리 생성**

   ```bash
   mkdir lang
   ```

2. **언어팩 파일 생성**

   ```bash
   vim lang/ja.json
   ```

3. **JSON 작성**

   ```json
   {
     "meta": {
       "version": "1.0",
       "compatibility": "0.1.0"
     },
     "messages": {
       "root_short": "TACHYON CLI - システム管理ツール",
       "info_title": "### TACHYON システム情報 ###",
       "service_check_title": "### TACHYON サービス状態チェック ###"
     }
   }
   ```

4. **실행**

   ```bash
   LANG=ja_JP.UTF-8 ./tkcli info
   ```

### 표준 언어팩 파일명

| 언어 | 파일명 | 환경 변수 예시 |
|------|--------|---------------|
| 영어 | `en.json` | `en_US.UTF-8` |
| 한국어 | `ko.json` | `ko_KR.UTF-8` |
| 일본어 | `ja.json` | `ja_JP.UTF-8` |
| 중국어 (간체) | `zh-cn.json` | `zh_CN.UTF-8` |
| 중국어 (번체) | `zh-tw.json` | `zh_TW.UTF-8` |
| 프랑스어 | `fr.json` | `fr_FR.UTF-8` |
| 독일어 | `de.json` | `de_DE.UTF-8` |
| 스페인어 | `es.json` | `es_ES.UTF-8` |
| 러시아어 | `ru.json` | `ru_RU.UTF-8` |

## 6.4 폴백 메커니즘

- 요청한 언어의 키가 없으면 자동으로 영어로 폴백됩니다.
- 언어팩 파일이 없으면 영어가 사용됩니다.

## 6.7 시스템 로케일 설정 (System Locale)

`tkcli env locale` 명령어를 사용하여 OS 시스템 전체의 로케일 설정을 관리할 수 있습니다. 이는 터미널에서의 한글 깨짐 현상을 근본적으로 해결하는 데 유용합니다.

```bash
# 시스템 로케일 확인
tkcli env locale

# 한글 로케일(ko_KR.UTF-8)로 설정
tkcli env locale ko --set
```

> 상세한 사용법은 [3.5 환경 구성 > 3.5.8 Locale 설정](manual/03_commands/05_environment.md?id=_358-locale-설정-locale)을 참조하십시오.

